---
title: "Reactã§ã‚µã‚¯ãƒƒã¨chromeã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã¤ãã‚‹"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React","chrome","JavaScript","TypeScript","GitHub"]
published: true
---
ç¾åœ¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ¡ç”¨ã«é–¢ã‚ã‚‹ä»•äº‹ã‚’ã‚„ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãã®éš›ã«GitHubã®ãƒšãƒ¼ã‚¸ã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãã‚Œã¦ã„ã‚‹ã®ã¯ã„ã„ã‚‚ã®ã®ã€ã©ã‚“ãªè¨€èªãŒå¾—æ„ãªã®ã‹ã€ãªã©ã®æŒ‡æ¨™ãŒãªã[GitHub Readme Stats](https://github.com/anuraghazra/github-readme-stats)ã‚’ã¿ã‚“ãªã¯ã£ã¦ãã‚ŒãŸã‚‰ã„ã„ã®ã«ãªï½  
ã¨æ€ã£ãŸã®ã§ã€chromeæ‹¡å¼µæ©Ÿèƒ½ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ
![screen](https://user-images.githubusercontent.com/69064290/142964241-0e132aa8-4317-45d1-a3b3-a55ecc0fffbc.png)

- ä½œã£ãŸæ‹¡å¼µæ©Ÿèƒ½
  - GitHub Language Stats

https://github.com/tokku5552/github-language-extension

- ä½¿ã„æ–¹

ç¾åœ¨å¯©æŸ»ã«å‡ºã—ã¦ã„ã‚‹æœ€ä¸­ãªã®ã§ã€ä¸Šè¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ã„ãŸã ãã€`npm install`ã—ãŸå¾Œ`npm run build`ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€`dist`ãƒ•ã‚©ãƒ«ãƒ€ãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™ã€‚
`dist`ãƒ•ã‚©ãƒ«ãƒ€ã‚’chromeã®æ‹¡å¼µæ©Ÿèƒ½ã®`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€`ã¨ã„ã†ã¨ã“ã‚ã§æŒ‡å®šã™ã‚‹ã¨ã€ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

:::message alert
æ³¨æ„ç‚¹ã¨ã—ã¦chromeã®æ‹¡å¼µæ©Ÿèƒ½ã®ç®¡ç†ç”»é¢ã§ç”»é¢å³ä¸Šã«ã‚ã‚‹`ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰`ã‚’ONã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::

## React + TypeScriptã§ä½œã‚‹
Chromeæ‹¡å¼µã¯æ‰€è©®JavaScriptãªã®ã§ã€TypeScriptã§é–‹ç™ºå‡ºæ¥ã¾ã™ã—ã€Vueã‚„Reactã‚‚ä½¿ãˆã¾ã™ã€‚
ä»Šå›ã¯ç°¡å˜ãªæ©Ÿèƒ½ã—ã‹ãªã„ã‚‚ã®ã®ã€ç°¡æ½”ã«æ›¸ã‘ã‚‹Reactã§ä½œã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
[ã“ã¡ã‚‰ã®ãƒ¬ãƒã‚¸ãƒˆãƒª](https://github.com/tokku5552/chrome-extension-sample)ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨`npm + webpack`ã§Reactã‚’ä½¿ã£ãŸChromeæ‹¡å¼µã®ã‚µãƒ³ãƒ—ãƒ«ãŒå‡ºæ¥ã¾ã™ã®ã§ã€Starterã®ã‚ˆã†ã«ä½¿ã£ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

- manifest.json

chromeæ‹¡å¼µã§ã¯ã€`manifest.json`ã§ã€åå‰ã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä»–ã€ã„ã¤èµ·å‹•ã™ã‚‹ã‹ã€ã©ã‚“ãªæ¨©é™ãŒå¿…è¦ã‹ç­‰ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚
ã©ã®ã‚ˆã†ãªã“ã¨ãŒè¨­å®šã§ãã‚‹ã‹ã¯[å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developer.chrome.com/docs/extensions/)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

ç§ãŒä½œã£ãŸæ‹¡å¼µæ©Ÿèƒ½ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
```json:manifest.json
{
  "manifest_version": 3,

  "name": "GitHub Language Stats",
  "description": "Chrome Extension Sample",
  "version": "1.0",

  "action": {
    "default_icon": "icon.png",
    "default_popup": "popup.html"
  },
  "content_scripts": [
      {
          "matches": ["<all_urls>"],
          "js": ["js/vendor.js", "js/content_script.js"]
      }
  ],

  "host_permissions": [
    "<all_urls>"
  ]
}

```

popupãŒé–‹ãã ã‘ã®ç°¡å˜ãªã‚‚ã®ã§ã™ã€‚URLã‚’è¦‹ã¦GitHubã®ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹åˆ¤æ–­ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦ã„ã‚‹ã®ã§ã€`host_permissions`ã‚’`<all_urls>`ã¨ã—ã¦ã„ã¾ã™ã€‚

## Reactã§ä½œã£ã¦ã„ã‚‹éƒ¨åˆ†
ã‹ãªã‚Šçªè²«ã§ä½œã£ãŸã®ã§ã€ã„ã‚‰ãªã„ã‚‚ã®ã‚‚è‰²ã€…ã¨æ®‹ã£ã¦ã„ã¾ã™ãŒã€æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã®ã¯å®Ÿè³ª`popup.tsx`ã®ã¿ã§ã™ã€‚

ä»¥ä¸‹ãŒã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ã¨ã“ã‚ã©ã“ã‚è§£èª¬ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ã‚Œã¦ã„ã¾ã™ã€‚

```tsx:popup.tsx
import React, { useEffect, useState } from "react";
import ReactDOM from "react-dom";
import axios, { AxiosResponse } from "axios"; // APIã‚’å©ãã®ã«axiosã‚’ä½¿ç”¨
import { useForm } from "react-hook-form"; // formã‚’ä½¿ã†ãŸã‚ã«react-hook-formã‚’ä½¿ç”¨

// GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã™ã‚‹ãŸã‚ã®å‹
// GitHubã®ãƒšãƒ¼ã‚¸ã«å±…ã‚Œã°è‡ªå‹•çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—
// ãã‚Œä»¥å¤–ã®ãƒšãƒ¼ã‚¸ã§ã¯ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã™ã‚Œã°ã€çµæœã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚
type FormData = {
  username: string;
};

const Popup = () => {
  const [username, setUsername] = useState<string>("");
  const [currentStats, setCurrentStats] = useState<AxiosResponse>();
  const [currentTopLanguage, setCurrentTopLanguage] = useState<AxiosResponse>();
  const {
    register,
    setValue,
    handleSubmit,
    formState: { errors },
  } = useForm<FormData>();

  // ãƒ•ã‚©ãƒ¼ãƒ ã«ç›´æ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥ã‚Œã¦submitã—ãŸã¨ãã«èµ°ã‚‹é–¢æ•°
  const onSubmit = handleSubmit((data) => {
    console.log(data["username"]);
    setUsername(data["username"]);
  });

  // useEffectã¯2ã¤ã«åˆ†ã‘ã¦ã„ã‚‹ã€‚ã“ã¡ã‚‰ã¯åˆæœŸåŒ–æ™‚ã®ã¿ã«ç™ºç«
  useEffect(() => {
    // chrome.**ã§chrome extensionç‰¹æœ‰ã®å‹•ä½œã‚’è¡Œãˆã‚‹ã€‚è©³ã—ãã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ã€‚
    // ã“ã“ã§ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®URLã‚’å–å¾—ã—ã¦
    // GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦usernameã«ã‚»ãƒƒãƒˆã—ã¦ã„ã‚‹
    chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
      const currentURL = tabs[0].url as string;
      const name = getGitHubUsername(currentURL) as string;
      setUsername(name);
      setValue("username", name);
    });
  }, []);

  // ã“ã¡ã‚‰ã¯usernameã‚’ç›£è¦–ã—ã¦ã„ã‚‹useEffect
  // useEffectå†…ã§éåŒæœŸå‡¦ç†ã—ãŸã„ã¨ãã¯ã€é–¢æ•°ã‚’åˆ¥ã«ã—ã¦å¾Œã‹ã‚‰å‘¼ã¶ã‚ˆã†ã«ã™ã‚‹
  useEffect(() => {
    const fetch = async (username: string) => {
      const stats = await getGitHubStats(username);
      const lang = await getGitHubTopLanguage(username);
      setCurrentTopLanguage(lang);
      setCurrentStats(stats);
    };
    console.log(username);
    // usernameãŒç©ºã‹undefinedã®æ™‚ã¯fetchã—ãªã„ã‚ˆã†ã«ã™ã‚‹
    // ã“ã‚Œã‚„ã‚‰ãªã„ã¨åˆå›ã®usernameã®fetchå‡¦ç†ã¨ã€usernameå–å¾—å¾Œã®fetchã¨
    // å‡¦ç†ãŒ2å›èµ°ã£ã¦ã€ãŸã„ã¦ã„ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹æ–¹ãŒå¾Œã‹ã‚‰è¿”å´ã•ã‚Œã‚‹ã®ã§
    // è¡¨ç¤ºã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
    if (username !== "" && username !== undefined) {
      console.log(username);
      fetch(username);
    }
  }, [username]);

  // statsã®APIå©ã„ã¦ã„ã‚‹ã ã‘ã€‚å°†æ¥çš„ã«ã¯ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é¸æŠå‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚
  const getGitHubStats = async (username: string) => {
    const response = await axios.get(
      `https://github-readme-stats.vercel.app/api?username=${username}&count_private=true&show_icons=true`
    );
    return response;
  };

  // top-langsã®APIå©ã„ã¦ã„ã‚‹ã ã‘ã€‚ã“ã¡ã‚‰ã‚‚ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã‹å¤‰ãˆã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨è‰¯ã•ãã†ã€‚
  const getGitHubTopLanguage = async (username: string) => {
    const response = await axios.get(
      `https://github-readme-stats.vercel.app/api/top-langs/?username=${username}&layout=compact`
    );
    return response;
  };

  // ã“ã“ã¯chrome.tab~~ã§å—ã‘å–ã£ãŸurlã‚’string -> urlObjã«å¤‰æ›ã—ã¦ã€hostnameã‚’å–å¾—
  // ãã®ã‚ã¨ã‚‚ã—ãã‚ŒãŒgithub.comã ã£ãŸã‚‰ãã®æ¬¡ã®URLã«å«ã¾ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—ã—ã¦ã„ã‚‹
  // GitHubã˜ã‚ƒãªã‹ã£ãŸã‚‰undefined
  const getGitHubUsername = (url: string) => {
    const urlObj = new URL(url);
    console.log(urlObj.hostname);
    if (urlObj.hostname === "github.com") {
      return urlObj.pathname.split("/")[1];
    }
  };

  return (
    <>
      <h1>GitHub Language Stats Extension</h1>
      <div dangerouslySetInnerHTML={{ __html: currentStats?.data }} />
      <div dangerouslySetInnerHTML={{ __html: currentTopLanguage?.data }} />
      <form onSubmit={onSubmit}>
        <label>GitHub username </label>
        <!-- ã“ã“ã§react-hook-formã‚’ä½¿ã£ã¦ã„ã‚‹ -->
        <input {...register("username")} placeholder="GitHub username" />
        <input type="submit" />
      </form>
    </>
  );
};

ReactDOM.render(
  <React.StrictMode>
    <Popup />
  </React.StrictMode>,
  document.getElementById("root")
);
```

## ã¾ã¨ã‚
ãƒ•ã‚©ãƒ¼ãƒ ãŒç”ŸHTMLã®ã¾ã¾ã¨ã„ã†ä½•ã¨ã‚‚è¨€ãˆãªã„æ„Ÿã˜ãªã®ã§ã€ãã®ã†ã¡`Chakra UI`ã§ã‚‚å½“ã¦ã¦ç¶ºéº—ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
Chromeæ‹¡å¼µæ©Ÿèƒ½ã®å…¬é–‹è‡ªä½“ã‚‚ä»–ã«è¨˜äº‹ãŒãŸãã•ã‚“ã‚ã‚‹ã—ã€ãã‚Œã‚’è¦‹ã¦ã‚Œã°åŸºæœ¬å›°ã‚‹ã“ã¨ã¯ãªã‹ã£ãŸã®ã§ã€ç‰¹ã«ã“ã®è¨˜äº‹ã§ã¯è¨€åŠã—ã¾ã›ã‚“ã€‚**$5**ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã€‚

[publicãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã‚‹](https://github.com/tokku5552/github-language-extension)ã®ã§ã€æ°—ã«å…¥ã£ãŸæ–¹ã¯ãŠä½¿ã„ã„ãŸã ããªã‚Šã€PRé€ã£ãŸã‚Šã—ã¦é ‚ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ï¼
Issueã§ã®ãƒã‚°å ±å‘Šã‚‚ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™!

## å‚è€ƒ

https://qiita.com/RyBB/items/32b2a7b879f21b3edefc

https://github.com/tokku5552/github-language-extension